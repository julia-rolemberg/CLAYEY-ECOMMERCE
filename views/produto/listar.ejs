<h1 class="tituloR">Produtos</h1>

<div class="tabela">
    <table class="table table-hover">
        <thead class="thead-dark">
            <tr>
                <th scope="col">ID</th>
                <th scope="col">Nome</th>
                <th scope="col">Descrição</th>
                <th scope="col">Composição</th>
                <th scope="col">Modo de uso</th>
                <th scope="col">Peso</th>
                <th scope="col">Fabricação</th>
                <th scope="col">Estoque</th>
                <th scope="col">Valor</th>
                <th scope="col"></th>
            </tr>
        </thead>

        <tbody>
            <!-- Construção dos itens da tabela -->
            <% for (let i = 0; i < lista.length; i++) { %>
                <tr>
                    <th scope="row"><%=lista[i].id_produto%></th>
                    <td><%=lista[i].nome_produto%></td>
                    <td><%=lista[i].desc_produto%></td>
                    <td><%=lista[i].composicao%></td>
                    <td><%=lista[i].utilidade%></td>
                    <td><%=lista[i].peso%>g</td>
                    <td><%=lista[i].fabricacao%></td>
                    <td><%=lista[i].qtdeDisponivel%></td>
                    <td>R$ <%=lista[i].valor_produto%></td>
                    <td>
                        <a href="/produto/alterar/<%=lista[i].id_produto%>" class="btn  btn-success btn-sm rounded-0"><i class="fa fa-edit"></i></a>
                        <button type="button" class="btn  btn-danger btn-sm rounded-0" onclick="excluir('<%=lista[i].id_produto%>')"><i class="fa fa-trash"  style="font-size:18px ;"></i></a>
                    </td>
                </tr>
            <% } %>
            
        </tbody>
    </table>
</div>

<script type="text/javascript">
    function excluir(id) {
        if ($.active) {
            return
        }

        if(!confirm(`Excluir produto ${id}?`)) {
            return
        }

        let opcoes = {
            url: "/api/produto/excluir/" + id,
            method: 'GET',

            success: function(dadosDeRetorno){
                alert('Sucesso!')
                location.reload();
            },

            error: function() {
                alert('Algo deu errado...')
            }
        };

        $.ajax(opcoes);
    }
</script>